Factory template code with auto registration of factory object types.
